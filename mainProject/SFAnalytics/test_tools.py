from tools import *
import sys

def main():
    if len(sys.argv) == 2:
        f = PEHandle(sys.argv[1])
        fileHashs = HashTable(sys.argv[1])
        opcodes = OpCodeFile(sys.argv[1])
        strings = Strings(sys.argv[1])
        print('Dlls do arquivo')
        print(f.getDlls())
        print('Numero total de dlls : {}'.format(len(f.getDlls())))
        print()
        print('Text list')
        print(f.getTextBytesList()[:35])
        print()
        print('Text entropy')
        print(f.getTextSectionEntropy())
        print()
        print('Data list')
        print(f.getDataBytesList()[:35])
        print()
        print('Data entropy')
        print(f.getDataSectionEntropy())
        print()
        print('Hashs do arquivo')
        print('MD5 : {}'.format(fileHashs.getHashMd5()))
        print('SHA256 : {}'.format(fileHashs.getHashSha256()))
        print()
        print('Primeiros 10 opcodes')
        print(opcodes.getOpcodes()[:10])
        print('Numero total de opcodes: {}'.format(opcodes.getCount()))
        print()
        print('Lista de Opcodes')
        rep = []
        total = 0
        totalPorcentage = 0
        for operation in opcodes.getOperations():
            for r in rep:
                if r == operation.op:
                    print("****************************************")
                    print("Error, the instruction already on vector")
                    print("****************************************")

            rep.append(operation.op)
            porcentage = (operation.num/opcodes.getCount()) * 100
            print("Operation:\t\t{}\t\tappears\t\t{}%".format(operation.op, format(porcentage, '.5g')))
            totalPorcentage += porcentage
            total += operation.num

        if total != opcodes.getCount():
            print("************************************************")
            print("Error, number of instructions differs from total")
            print("************************************************")

        if totalPorcentage < 99.9 or totalPorcentage > 100.1:
            print("************************************************")
            print("Error, total porcentage : {}".format(totalPorcentage))
            print("************************************************")

        print()
        print('****************************************************')
        print('Total de instrucoes em Operations : {}'.format(total))
        print('****************************************************')
        print('Total em totalPorcentage : {}'.format(totalPorcentage))
        print('****************************************************')
        print('****************************************************')
        print('Total de instrucoes diferentes : {}'.format(len(opcodes.getOperations())))
        print('****************************************************')
        print()
        print('Primeiras 10 Strings')
        print(strings.strings[:10])
        print('Numero total de strings: {}'.format(strings.getCount()))
    else:
        print('Define a exec')
        exit()

if __name__ == '__main__':
    main()
